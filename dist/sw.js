const CACHE_NAME="story-app-cache-v1",assetsToCache=["/","/index.html","/manifest.json","/icons/icon-192x192.png","/icons/icon-512x512.png","/images/placeholder.svg","https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css","https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css","https://unpkg.com/leaflet@1.9.4/dist/leaflet.css","https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js","https://unpkg.com/leaflet@1.9.4/dist/leaflet.js","https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png","https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png","https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"];self.addEventListener("install",(e=>{console.log("Installing Service Worker..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Service Worker: Caching App Shell"),e.addAll(assetsToCache)))))})),self.addEventListener("activate",(e=>{console.log("Activating Service Worker..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.filter((e=>e!==CACHE_NAME)).map((e=>caches.delete(e)))))))})),self.addEventListener("fetch",(e=>{const t=new URL(e.request.url);t.origin===location.origin?"https://story-api.dicoding.dev"!==t.origin?e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))).catch((()=>e.request.url.includes("/images/")?caches.match("/images/placeholder.svg"):e.request.headers.get("Accept").includes("text/html")?caches.match("/index.html"):new Response("Tidak dapat terhubung ke internet",{status:503,statusText:"Service Unavailable",headers:new Headers({"Content-Type":"text/plain"})})))):e.respondWith(fetch(e.request).then((t=>{const s=t.clone();return caches.open(CACHE_NAME).then((t=>{t.put(e.request,s)})),t})).catch((()=>caches.match(e.request)))):e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))).catch((e=>(console.log("Fetch error:",e),caches.match("/images/placeholder.svg")))))})),self.addEventListener("push",(e=>{console.log("Service Worker: Received push event");let t={};try{t=e.data.json()}catch(e){t={title:"Story App Notification",body:"Ada cerita baru untuk dilihat!",icon:"/icons/icon-192x192.png"}}const s={body:t.body||"Ada cerita baru untuk dilihat!",icon:t.icon||"/icons/icon-192x192.png",badge:"/icons/icon-192x192.png",vibrate:[100,50,100],data:{url:t.url||"/"}};e.waitUntil(self.registration.showNotification(t.title||"Story App Notification",s))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data&&e.notification.data.url?e.notification.data.url:"/";e.waitUntil(clients.openWindow(t))}));